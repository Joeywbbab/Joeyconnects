# FlowTree Web 版存储机制说明

## 存储方式

FlowTree Web 版使用**浏览器本地存储**，数据完全存储在用户的浏览器中，不会上传到任何服务器。

## 存储技术

### 1. IndexedDB（优先使用）
- **容量限制**：
  - **Chrome/Edge**: 通常为可用磁盘空间的 60%，但至少 1GB，最多可达 60% 的磁盘空间
  - **Firefox**: 通常为可用磁盘空间的 50%，至少 1GB
  - **Safari**: 通常为 1GB（较保守）
  - **实际可用**: 在大多数情况下，可以存储 **几百 MB 到几 GB** 的数据
- **优势**：支持大文件，适合存储大量图片
- **位置**：浏览器数据库（Chrome: DevTools → Application → IndexedDB → FlowTreeDB）

### 2. localStorage（备用方案）
- **容量限制**：
  - **大多数浏览器**: **5-10 MB**（硬限制）
  - **Chrome**: 约 10 MB
  - **Firefox**: 约 10 MB
  - **Safari**: 约 5 MB
- **使用场景**：当 IndexedDB 不可用时自动切换
- **位置**：浏览器存储（Chrome: DevTools → Application → Local Storage）

## 存储限额详细说明

### IndexedDB 实际限额
- **最小保证**: 至少 1GB（大多数现代浏览器）
- **典型可用**: 2-5 GB（取决于磁盘空间）
- **最大可能**: 可达磁盘空间的 50-60%（取决于浏览器和磁盘大小）

### 实际使用建议
- **图片数量**: 可以存储 **数百到数千张** 高清图片（取决于图片大小）
- **Base64 编码**: 图片以 Base64 编码存储，大小约为原图的 **133%**（因为 Base64 编码会增加约 33% 的大小）
- **示例计算**:
  - 1MB 原图 → 约 1.33MB 存储空间
  - 100 张 1MB 图片 → 约 133MB 存储空间
  - 在 2GB 限额下，可以存储约 **15,000 张** 1MB 的图片

### 存储空间检查
可以通过以下方式检查当前使用的存储空间：
1. **Chrome**: DevTools → Application → Storage → 查看 "Usage" 信息
2. **Firefox**: DevTools → Storage → IndexedDB → 查看大小
3. **代码检查**: 浏览器控制台运行 `navigator.storage.estimate()` 查看配额和使用情况

## 数据存储内容

- Flow 结构（名称、sections、groups、steps）
- 图片数据（Base64 编码，原始质量，不压缩）
- 热点标注信息
- 注释说明
- 所有用户创建的交互流程数据

## 数据持久化

- ✅ **自动保存**：每次修改后自动保存到浏览器存储
- ✅ **实时保存**：输入框内容实时保存，不会丢失
- ✅ **跨会话**：关闭浏览器后数据仍然保留

## 数据迁移

- 应用启动时会自动检测 IndexedDB 是否可用
- 如果 IndexedDB 不可用，会自动使用 localStorage
- 如果 localStorage 中有旧数据，会自动迁移到 IndexedDB

## 数据导出/导入

### 导出
- 点击 "📤 Export All" 导出所有 Flow 为 JSON 文件
- 点击单个 Flow 的 "📤" 按钮导出单个 Flow
- JSON 文件包含所有数据，包括图片（Base64 编码）

### 导入
- 点击 "📥 Import" 导入 JSON 文件
- 支持导入单个或多个 Flow
- 如果 ID 冲突，会自动生成新 ID

## 数据安全

- ✅ **本地存储**：数据只存在于用户浏览器，不会上传到服务器
- ✅ **隐私保护**：所有数据都在用户本地
- ⚠️ **浏览器清理**：清除浏览器数据会删除所有 FlowTree 数据
- ⚠️ **多设备**：不同设备/浏览器的数据是独立的

## 备份建议

1. **定期导出**：建议定期使用 "Export All" 功能导出 JSON 备份
2. **保存备份**：将导出的 JSON 文件保存到安全的地方（本地硬盘、云盘等）
3. **版本控制**：可以为不同版本创建不同的备份文件

## 技术细节

### IndexedDB 结构
```
FlowTreeDB
  └── flows (ObjectStore)
      └── 每个 Flow 作为一个对象存储
          - id: 唯一标识
          - name: Flow 名称
          - sections: 所有 sections 数据
          - 包含所有图片（Base64）
```

### 图片存储
- 图片以 **Base64 编码** 存储在数据对象中
- **不压缩**：保持原始图片质量
- 每张图片都会完整存储在 IndexedDB 中

## 常见问题

**Q: 数据会丢失吗？**
A: 只有在清除浏览器数据时才会丢失。建议定期导出备份。

**Q: 可以在不同设备间同步吗？**
A: 不可以。数据只存储在本地浏览器。可以通过导出/导入 JSON 文件来迁移数据。

**Q: 存储空间满了怎么办？**
A: IndexedDB 容量很大，通常不会满。如果满了，可以删除一些 Flow 或导出后删除。

**Q: 如何查看存储的数据？**
A: 打开浏览器开发者工具（F12）→ Application → IndexedDB → FlowTreeDB → flows

